# coding=UTF-8

import pprint
import pandas as pd

from pathlib import Path

from langchain.document_loaders import TextLoader
from langchain.embeddings import HuggingFaceEmbeddings
from langchain.text_splitter import CharacterTextSplitter
from langchain.vectorstores import Chroma
from langchain.document_loaders.csv_loader import CSVLoader
from langchain.schema import Document

model_name = "sentence-transformers/paraphrase-multilingual-mpnet-base-v2"
model_kwargs = {"device": "cpu"}
embeddings = HuggingFaceEmbeddings(model_name=model_name, model_kwargs=model_kwargs)

chroma_db_filepath = Path("./chroma_db")
if chroma_db_filepath.exists():
    db = Chroma(embedding_function=embeddings, persist_directory=str(chroma_db_filepath))
else:
    df = pd.read_csv('Data/clean_output1.csv', sep = ";")

    documents = df.apply(lambda row: Document(page_content = row['textContent']
                                            , metadata = {'source' : row['id']}), axis=1)

    # Ten plik documnets możesz joinowac
    # loader = TextLoader("../Data/state of the union.txt")
    # documents = loader.load()
    # csv_loader = CSVLoader()
    # documents = csv_loader.load("../Data/clean_output1.csv")

    text_splitter = CharacterTextSplitter(chunk_size=1000, chunk_overlap=300)
    docs = text_splitter.split_documents(documents)
    db = Chroma.from_documents(docs, embeddings, persist_directory=str(chroma_db_filepath))

query = "powód B M wnieść unieważnieć uchwała oznaczyć numer 10 lipiec 1998 rok podjąć zgromadzić wspólnik pozwany przedsiębiorstwo spółka ograniczyć odpowiedzialność K zasądzić koszt proces motywować uchwały głosować określić § 13 umowa Spółka zawrzeć postanowienie wspólnik przysługiwać głos wzgląd wysokość posiadany udział zdanie mieć znaczenie prawny zastosowanie zasada udział przypadać głos stwierdzić uchwała zostać podjąć jednomyślnie sprzeczny postanowieć umowa ponadto podjąć zostać zamiar pokrzywdzeć zaaprobować zgłoszoć propozycja udział objąć „ niekwestionowany wspólnik ” jednocześnie zaskarżić uchwała winien uchylć zostać podjąć wbrew dobry obyczaj kupiecki godzić interes Spółka mieć cel pokrzywdzenie Pozwan wnieść oddalić powództwo zasądzeć koszt proces uzasadnić swój stanowisko zaskarżyć uchwała zostać podjąć zgodnie umowa Spółka reguluć liczba głos stosownie artykuł 233 kh Stwierdziła podwyższenie kapitał nastąpić moc dotychczasowy postanowienie umowa Spółka zachodzić konieczność dochować forma akt notarialny cel zaskarżyć uchwała pokrzywdzenie powód dobro Spółka kapitał zakładowy wynosić 50 złoty stwarzać utrudnienie działalność mianowicie okazja udział przetarg staranie kredyt gwarancja bankowy zawierać umowa kontrahenta powód mieć środek pieniężny objąć udział Zaskarżony wyrokie sąd okręgowy Katowice oddalić powództwo Rozstrzygnięcie oprzeć następujący ustalenia dzień 29 kwiecień 1997 rok D udziałowiec pozwany spółka bezwarunkowy umowa sprzedaż zbyć udział Spółka umowa Spółka zawierać postanowienie prawo pierwokup udział dotychczasowy wspólnik przeciwieństwo powód nabywiec powód wnieść sąd rejonowy K pozew uznać czynność prawny bezskuteczny wobec sąd wyrokie 23 czerwiec 1998 rok powództwo uwzględnić wyrok uprawomocnić dzień 29 listopad 2001 rok umowa sprzedaż udział odnieść skutek względem powód uzyskać uprawnienie złożyć oświadczenie wola wykonać przysługuć prawo pierwokup umowa skuteczny względem Spółka podmiot zgromadzenie wspólniek Spółka dzień 25 marzec 1998 rok podjąć uchwała treść „ podwyższeć kapitał zakładowy spółka 1 milion złoty stanowić zmiana umowa spółka uchwała podwyższeć kapitał podejmować zgromadzenie Wspólników zwykły większość głos uchwała przedmiot zmiana § 14 umowa Spółka pierwotny numeracja – § 13 wykreślać zdanie 5 6 wymagać jednomyślność uchwała zobowiązać wspólnik dopłata wyznaczeć wspólnik obejmować udział podwyższeć kapitał zakładowy zmiana zostać wpisać rejestr handlowy sąd rejonowy K postanowienie 8 czerwiec 1998 rok dzień 10 lipiec 1998 rok odbyć nadzwyczajny posiedzenie zgromadzenie wspólnik pozwany Spółka prócz powód wziąć udział E H 1 D wówczas zgromadzić wspólnik podjąć zaskarżony uchwała podwyższeć kapitał zakładowy 10000 złoty objęcie 1000 udział wartość 5 złoty E H 1 D Powód złożyć sprzeciw przeciw uchwale stwierdzać wspólnik głosować liczba posiadany udział ponadto podjąć zostać cel pokrzywdzeć „ pismo 17 czerwiec 2002 rok powód złożyć oświadczenie zamierzać skorzystać przysługuć prawo pierwokup udział ” wykazać zapłacić cena udział złożyć depozyt sądowy sąd okręgowy stwierdzić postanowienie umowa Spółka wspólnik zgromadzenie wspólniek przypadać głos zgodny artykuł 233 kh zasadny „ zarzut powód dotyczyć niezachować forma akt notarialny podwyższeć kapitał zakładowy jednomyślność ” stosownie artykuł 255§1 kh forma akt notarialny wymagać podwyższyć kapitał zakładowy następować moc dotychczasowy postanowienie umowa spółka skoro zgromadzić wspólnik pozwany dzień 25 marzec 1998 rok uchwalić zmiana umowa Spółka podwyższić kapitał zakładowy 1000000 złoty stanowić zmiana głosować Tez powód wymagać forma akt notarialny uchwała podwyższeć kapitał zakładowy 10000 złoty dzień 10 lipiec 1998 rok umowa Spółka wymagać jednomyślność podjąć uchwała podwyższeć kapitał zakładowy sąd pierwszy instancja stwierdzić powództwo zasadny umowa Spółka zostać wprowadzić zmiana uchwalć zgromadzić wspólniek dzień 25 marzec 1998 rok skoro zmiana zostać uchwalć zaskarżić uchwała podjąć zostać zgodnie umowa Spółka prawo E H 1 uprawniony głosować podstawa umowa sprzedaż 29 kwiecień 1997 rok nabyć D udział Spółka wyrok stwierdzajyć bezskuteczność względnąć przedmiotowo podmiotowo umowa sprzedaż udział Spółka oparcie artykuł 59 kc działać wstecz chwila zawrzeć umowa bezskuteczny odniesienie powód orzeczenie przedmiot mieć cel umożliwić wykonać prawo pierwokup Nabycie udział powód skuteczny stosunek osoba trzeci strona bezwarunkowy umowa sprzedaż dopiero uprawniyć prawo pierwokup zapłacić cena udział złożyć depozyt sądowy powód złożyć oświadczenie zamiarze skorzystać prawo pierwokup udział Spółka wykazać zapłata cena udział złożyć depozyt sądowy Zaskarżona uchwała zostać podjąć wzgląd dotychczasowy wysokość kapitał zakładowy spółka 50 złoty „ obrót gospodarczy musieć utrudniać funkcjonować Spółka podwyższenie związek realizacja przetarg zaciągać kredyt czynność konieczny ” powód udowodnić uchwała mieć cel pokrzywdzenie zostać wykazany przesłanka unieważnieć uchwała stanowić artykuł 240§1 2 kh orzeczenie koszt proces uzasadnić treść artykuł 98 108§1 apelacja powód wnieść zmiana zaskarżyć wyrok uwzględnieć powództwo zarzucić naruszyć prawo materialny mianowicie artykuł 59 kc błędny wykładnia niewłaściwy zastosowanie polegać przyjąć uznać umowa bezskuteczny wzgląd powód mieć wpływ stosunki osoba trzeci zwłaszcza pozwać konsekwencja prawny umowa stosunek osoba występować nadal wyłącznie zakres dawać pogodzić realizacja roszczenie osoba wobec zostać uznać bezskuteczna zarzucić naruszyć przepis postępowanie polegać niewyjaśnieć istotny okoliczność sprawa pominięć fakt wskazywać wspólnik podjąć zaskarżony uchwała wbrew dobry obyczaj kupiecki cel pokrzywdzeć powód ponadto sprzeczność ustalenie poczynioć sąd pierwszy instancja treść zebrać materiał dowodowy przyjąć skorzystać prawo pierwokup skoro pozwany ciąża obowiązek powiadomić zbyciu udział dotąd uczynić sytuacja nadal móc skorzystać prawo zamierzać uczynić podejmować stosowny działanie przyjąć zachodzić podstawa uchyleć zaskarżyć uchwała sąd apelacyjny zważyć następować Apelacja zasługiwać uwzględnieć sąd apelacyjny podzielać ustalenie faktyczny poczynić sąd okręgowy prawidłowy przyjmować własny względny bezskuteczność umowa sprzedaż udział pozwany Spółka zawarli D E H 1 skutek konstytutywny orzeczenie uprawomocnić dopiero chwila rozpoznać sąd Najwyższy wyrokie 29 listopad 2001 rok sygn akta V CKN 536 00 kasacja wyrok sąd okręgowy K rozpoznać apelacja wyrok sąd rejonowy K 23 czerwiec 1998 rok vide powołać wyrok sąd wysoki znajdować akta GC 2394 97 sąd rejonowy K bezskuteczność względny umowa sprzedaż działać chwila zawrzeć ex tuncć oznaczać E H 1 móc dzień 10 lipiec 1998 rok wykonywać uprawnienie wspólnik podmiotowy przedmiotowy zakres bezskuteczność określić konstytutywny orzeczenie Bezskuteczność umowa odnosić wyłącznie powód móc wykonać przysługuć prawo pierwokup udział zatem podnoszyć skarżący okoliczność skutek prawny bezwarunkowy umowa sprzedaż udział stosunek osoba nadal występować wyłącznie zakres dawać pogodzić realizacja roszczenie osoba wobec zostać uznać bezskuteczny odnosić wykonać prawo pierwokup Skutek postać nabyć udział Spółka powód nastąpić móc wcześnie uprawomocnienie naprowadzony wyrok sąd rejonowy K Nabycie udział powoed nastąpiłoby dopiero chwila skuteczny uiszczenia cena wyznaczony termin chwila zapłata powód nabyć udział miejsce E H 1 dopiero chwila powstać skutek nabyć wobec osoba trzeci spółka strona umowa porównaj uzasadnienie publ wyrok sąd wysoki 29 listopad 2001 rok sygn akta V CKN 536 00 dzień 10 lipiec 1998 rok E H 1 móc wykonywać uprawnienie korporacyjny Spółka znaczenie rozstrzygnąć powód wykonać przysługuć prawo pierwokup – wbrew twierdzeniom apelacja – wykazać postępowanie sąd pierwszy instancja przyczyna prawo pierwokup wykonywać złożć oświadczenie zobowiązany artykuł 597§2 kc powód przedłożyć Sąd Okręgowemu pismo 17 czerwiec 2002 rok zaadresować nadać nabywca zawierać oświadczenie zamierzać wykonać prawo pierwokup wezwanie motywować „ nadzwyczajny zmiana stosunki ” złożyć „ oferta zakup wyżej wymieniony udział adekwatny obecny wartość ” k 117 powód udowodnić wykonać prawo pierwokup udział musiać wykazać cena E H nabyć udział 8000 złoty wynikać powołany wcześnie wyrok sąd wysoki uiścić zbywca złożyć depozyt sądowy nastąpić warunki Zbędny dalsza analiza zarzut oprzeć twierdzić mieć wykonać prawo pierwokup udział skoro prawo wykonać dopiero prawomocność naprowadzony wyrok sąd rejonowy K sprawa uznać czynność prawny bezskuteczny wzgląd powód zatem podjęć zaskarżyć uchwała stosownie artykuł 240§2 kh uchwała wspólniek móc zaskarżić przypadek zgodność przepis prawo postanowienie umowa spółka uchwała wbrew dobry obyczaj kupiecki godzić interes spółka mieć cel pokrzywdzenie wspólnik zatem powoda obciążać wykazać zaskarżyć uchwała jednocześnie podjąć zostać naruszeć dobry obyczaj kupiecki cel pokrzywdzenie wspólnik powód istota wykazywać naprowadzony koniunkcja trudno doszukać sprawa okoliczność wskazywać podjąć zaskarżyć uchwała wbrew dobry obyczaj kupiecki zarzut powód wyartykułować dopiero tok proces mianowicie pismo 20 czerwiec 2002 rok ograniczać stwierdzenie zaskarżyć uchwała zostać podjąć wbrew obyczaj wskazać mieć polegać naruszenie okoliczność faktyczny udowodnienąć podobnie pozostały przesłanka artykuł 240§2 kh ciążyć artykuł 6 kc powód wywodzić zaskarżyć uchwała zostać podjąć cel pokrzywdzeć mieć świadczyć brak aprobat pozostały wspólnik propozycja udział objąć „ niekwestionowany wspólnik ” powód D oprzeć nieprawomocny wyrok sąd rejonowy K dzień 23 czerwiec 1998 rok sprawa uznać umowa sprzedaż udział bezskuteczny wzgląd powód powód istota twierdzić dzień 10 lipiec 1998 rok należeć ograniczyć uprawnienie E H 1 wspólnik pozwany Spółka wówczas umowa sprzedaż udział zawrzeć D pełnia skuteczny E H 1 dzień 10 lipiec 1998 rok móc wykonywać prawo wspólnik podobnie powód Skoro brak twierdzenie E H dysponować środek pieniężnymi objąć udział 5000 złoty trudno zasadnie uznać zaskarżyć uchwała mieć cel pokrzywdzenie powoda wykazać mieć środki pieniężny objąć udział twierdzić wówczas uiszczć kilkukrotć mały kwota tytuć koszt sądowy 1172 złoty doprowadziłoba uszczerbek konieczny utrzymać rodzina porównaj zażaleć powód postanowienie sąd wojewódzki K 11021998 rok sprawa GC 1514 97 k 63 kapitał zakładowy Spółka wynosić 50 złoty powód wykazać podwyższenie kapitał nastąpić cel zwiększyć wiarygodność Spółka obrót gospodarczy podkreślić sąd pierwszy instancja sprawa brak okoliczność sąd apelacyjny winien uwzględnić urząd artykuł 378§1 przyczyna rozpoznać sprawa badając zarzut podniesiyć apelacja Reasumując zaskarżyć wyrok zawierać zarzucanych wada dodać należeć zarzut naruszyć przepis postępowanie zachodzić nieważność postępowanie swój skuteczność wymagać wykazać wpływ uchybienie treść rozstrzygnąć zaskarżony wyrok prawidłowy skoro powód wykazać zachodzić przesłanka uchyleć zaskarżyć uchwała porównaj artykuł 243§1 kh stanowić artykuł 240§1 2 kh mieć zastosowanie sprawa porównaj artykuł 622 ksh zatem apelacja – bezzasadny – podlegać oddaleć podstawa artykuł 385"


sim = db.similarity_search_with_score(
    query, k=4
)

# embedding_vector = embeddings.embed_query(query)
# docs_and_scores = db.similarity_search_by_vector(embedding_vector)

results = [(score, doc.metadata["source"], doc.page_content) for (doc, score) in sim]
results.sort(key=lambda x: x[0])

pprint.pprint(results)